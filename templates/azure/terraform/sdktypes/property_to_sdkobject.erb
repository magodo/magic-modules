<%
    direct_children = Set.new
    sdk_marshal.properties.reject{|p| p.output}
                          .sort_by{|p| [p.order, p.name]}.each do |prop|
      prop.azure_sdk_references.select{|ref| sdk_marshal.sdktype.type_definitions.has_key?(ref)}.each do |child_api_path|
        child_type_def = sdk_marshal.sdktype.type_definitions[child_api_path]
        api_path = sdk_marshal.sdktype.typedef_reference
        if api_path == '/' && child_api_path.start_with?(api_path)
          sub_paths = child_api_path.split('/')
          api_path = ''
        elsif child_api_path.start_with?(api_path + '/')
          sub_paths = child_api_path[api_path.length..-1].split('/')
        end
        skip_empty = child_type_def.empty_value_sensitive && !include_empty
        if !sub_paths.nil? && sub_paths.length > 1 && sub_paths[0] == '' && !skip_empty
          sub_api_path = api_path + '/' + sub_paths[1]
          direct_children << sub_api_path if sub_paths.length > 2
          direct_children << child_api_path if sub_paths.length == 2
        end
      end
    end

    direct_children.to_a.sort.each do |child_api_path|
      matched_properties = get_properties_matching_sdk_reference(sdk_marshal.properties, child_api_path)
      child_sdk_marshal = sdk_marshal.clone(child_api_path)
-%>
<%=   lines(child_sdk_marshal.sdktype.type_definition.render_property_to_sdk_field(child_sdk_marshal, nil)) if matched_properties.empty? -%>
<%    matched_properties.reject{|p| p.output}
                        .each do |property| -%>
<%=     lines(child_sdk_marshal.sdktype.type_definition.render_property_to_sdk_field(child_sdk_marshal, property)) -%>
<%    end -%>
<%  end -%>
