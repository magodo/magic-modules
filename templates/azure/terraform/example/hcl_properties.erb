<%
    # props_left: [[name_1, val_1], [name_2, val_2], ...]
    props_left = properties.to_a
    is_first_section = true
    begin
      simple_props = props_left.take_while{|p| !p[1].is_a?(Hash) && !(p[1].is_a?(Array) && p[1].length > 0 && p[1][0].is_a?(Hash))}
      props_left = props_left.drop_while{|p| !p[1].is_a?(Hash) && !(p[1].is_a?(Array) && p[1].length > 0 && p[1][0].is_a?(Hash))}

-%>
<%=   "\n" if !is_first_section && !simple_props.empty? -%>
<%
      is_first_section = false unless simple_props.empty?

      prop_alignment = simple_props.map{|p| p[0].length}.max
      simple_props.each do |prop|
        if prop[1].is_a?(String)
-%>
<%=       prop[0].ljust(prop_alignment) -%> = "<%= prop[1] -%>"
<%      elsif prop[1].is_a?(Integer) || prop[1].is_a?(TrueClass) || prop[1].is_a?(FalseClass) -%>
<%=       prop[0].ljust(prop_alignment) -%> = <%= lines(prop[1].to_s) -%>
<%      elsif prop[1].is_a?(Array) && (prop[1].length == 0 || prop[1][0].is_a?(String))
          res_arr = prop[1].map{|elem| "\"#{elem}\""} -%>
<%=       prop[0].ljust(prop_alignment) -%> = [<%= res_arr.join(", ") -%>]
<%      else -%>
// TODO: Unsupported property "<%= prop[0] -%>" value <%= lines(prop[1]) -%>
<%
        end
      end

      complex_props = props_left.take_while{|p| p[1].is_a?(Hash) || (p[1].is_a?(Array) && p[1].length > 0 && p[1][0].is_a?(Hash))}
      props_left = props_left.drop_while{|p| p[1].is_a?(Hash) || (p[1].is_a?(Array) && p[1].length > 0 && p[1][0].is_a?(Hash))}
      complex_props.each do |prop|
        blocks = prop[1].is_a?(Array) ? prop[1] : [prop[1]]
        blocks.each do |block|
-%>
<%=       "\n" unless is_first_section -%>
<%
          is_first_section = false
-%>
<%=       prop[0] -%> <%= "= " if prop[0] == "tags"-%>{
<%=       lines(build_hcl_properties(block)) -%>
}
<%
        end
      end
    end until props_left.empty?
-%>